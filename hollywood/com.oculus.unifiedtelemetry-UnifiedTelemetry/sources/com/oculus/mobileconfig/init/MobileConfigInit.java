package com.oculus.mobileconfig.init;

import X.AbstractC0096Hu;
import X.AbstractC0234Xa;
import X.AbstractC0246Xt;
import X.AbstractC0247Xu;
import X.AnonymousClass06;
import X.C00198b;
import X.C0088Gy;
import X.DB;
import X.GA;
import X.Gt;
import X.Pj;
import X.QC;
import X.RU;
import X.XX;
import X.XY;
import X.eJ;
import android.content.Context;
import android.content.pm.PackageInfo;
import com.facebook.inject.ApplicationScoped;
import com.facebook.inject.ForAppContext;
import com.facebook.mobileconfig.MobileConfigDependenciesInFBApps;
import com.facebook.mobileconfig.MobileConfigManagerHolderImpl;
import com.facebook.mobileconfig.MobileConfigManagerParamsHolder;
import com.facebook.ultralight.AutoGeneratedFactoryMethod;
import com.facebook.ultralight.Dependencies;
import com.facebook.ultralight.Inject;
import com.facebook.xanalytics.XAnalyticsProvider;
import com.google.common.collect.ImmutableMap;
import com.oculus.auth.credentials.Credentials;
import com.oculus.auth.credentials.CredentialsModule;
import com.oculus.common.init.INeedInit;
import com.oculus.errorreporting.interfaces.IErrorReporter;
import com.oculus.util.device.DeviceUtils;
import java.io.IOException;
import java.util.Locale;
import java.util.concurrent.Callable;

@Dependencies({"_UL__ULSEP_android_content_Context_ULSEP_com_facebook_inject_ForAppContext_ULSEP_BINDING_ID", "_UL__ULSEP_com_facebook_xanalytics_XAnalyticsProvider_ULSEP_BINDING_ID", "_UL__ULSEP_android_content_pm_PackageInfo_ULSEP_BINDING_ID", "_UL__ULSEP_com_facebook_mobileconfig_factory_MobileConfig_ULSEP_BINDING_ID", "_UL__ULSEP_com_oculus_auth_credentials_Credentials_ULSEP_BINDING_ID", "_UL__ULSEP_java_util_Locale_ULSEP_BINDING_ID", "_UL__ULSEP_com_oculus_errorreporting_interfaces_IErrorReporter_ULSEP_BINDING_ID", "_UL__ULSEP_com_oculus_mobileconfig_init_MobileConfigInitOptions_ULSEP_BINDING_ID"})
@ApplicationScoped(enableScopeValidation = false)
public class MobileConfigInit implements INeedInit {
    public static String TAG;
    public static volatile MobileConfigInit _UL__ULSEP_com_oculus_mobileconfig_init_MobileConfigInit_ULSEP_INSTANCE;
    public QC _UL_mInjectionContext;
    public final AbstractC0246Xt<Context> mContextLazy;
    public final eJ<Credentials> mCredentialsProvider;
    public final AbstractC0246Xt<IErrorReporter> mErrorReporterLazy;
    public final eJ<Locale> mLocaleProvider;
    public final eJ<AbstractC0234Xa> mMobileConfigFactoryProvider;
    public final eJ<PackageInfo> mPackageInfoProvider;
    public final AbstractC0246Xt<XAnalyticsProvider> mXAnalyticsProvider;

    public static synchronized MobileConfigManagerHolderImpl A00(MobileConfigInit mobileConfigInit, Credentials credentials) {
        MobileConfigManagerHolderImpl createManager;
        synchronized (mobileConfigInit) {
            MobileConfigManagerParamsHolder mobileConfigManagerParamsHolder = new MobileConfigManagerParamsHolder();
            mobileConfigManagerParamsHolder.setConsistencyLoggingEnabled(true);
            mobileConfigManagerParamsHolder.setConsistencyLoggingEveryNSec(2592000);
            mobileConfigManagerParamsHolder.setUniverseType(((MobileConfigInitOptions) AbstractC0096Hu.A03(0, 131, mobileConfigInit._UL_mInjectionContext)).mUniverseType.getValue());
            mobileConfigManagerParamsHolder.setResponseCompressionEnabled(false);
            mobileConfigManagerParamsHolder.setQueryHashOptimization(false);
            ImmutableMap.Builder builder = new ImmutableMap.Builder();
            builder.put("locale", mobileConfigInit.mLocaleProvider.get().toString());
            createManager = new MobileConfigDependenciesInFBApps(null, null, false, mobileConfigInit.mXAnalyticsProvider.get().mXAnalyticsAdapter).createManager(mobileConfigInit.mContextLazy.get().getFilesDir(), mobileConfigInit.mPackageInfoProvider.get().versionName, DeviceUtils.A00(mobileConfigInit.mContextLazy.get()), credentials.mUserId, "", mobileConfigInit.mContextLazy.get().getAssets(), false, mobileConfigManagerParamsHolder, builder.build());
        }
        return createManager;
    }

    public final synchronized void A02(Credentials credentials, GA ga) {
        RU ru = ga.A06;
        if (ru instanceof XX) {
            XX xx = (XX) ru;
            if (xx.A00() instanceof XY) {
                xx.A01(A00(this, credentials), ga);
            }
        }
    }

    @Override // com.oculus.common.init.INeedInit
    public final void A36() {
        synchronized (this) {
            try {
                GA ga = (GA) this.mMobileConfigFactoryProvider.get();
                final Credentials credentials = this.mCredentialsProvider.get();
                if (credentials != null) {
                    ga.A06();
                    if (ga.A0A.get()) {
                        DB.A00(new Callable<Void>() {
                            /* class com.oculus.mobileconfig.init.MobileConfigInit.AnonymousClass1 */

                            /* Return type fixed from 'java.lang.Object' to match base method */
                            @Override // java.util.concurrent.Callable
                            public final Void call() throws Exception {
                                MobileConfigInit mobileConfigInit = MobileConfigInit.this;
                                mobileConfigInit.A02(credentials, (GA) mobileConfigInit.mMobileConfigFactoryProvider.get());
                                return null;
                            }
                        }, DB.A0C);
                    } else {
                        ((XX) ga.A06).A01(A00(this, credentials), ga);
                        GA.A03(ga);
                    }
                }
                ga.A06.isValid();
            } catch (Exception e) {
                if (!(e instanceof IOException)) {
                    this.mErrorReporterLazy.get().A5I(TAG, e.getMessage(), e);
                }
            }
        }
    }

    @AutoGeneratedFactoryMethod
    public static final MobileConfigInit A01(AbstractC0247Xu xu) {
        if (_UL__ULSEP_com_oculus_mobileconfig_init_MobileConfigInit_ULSEP_INSTANCE == null) {
            synchronized (MobileConfigInit.class) {
                Pj A00 = Pj.A00(_UL__ULSEP_com_oculus_mobileconfig_init_MobileConfigInit_ULSEP_INSTANCE, xu);
                if (A00 != null) {
                    try {
                        AbstractC0247Xu applicationInjector = xu.getApplicationInjector();
                        _UL__ULSEP_com_oculus_mobileconfig_init_MobileConfigInit_ULSEP_INSTANCE = new MobileConfigInit(applicationInjector, new C00198b(3, applicationInjector), new C00198b(46, applicationInjector), new Gt(89, applicationInjector), new C0088Gy(115, applicationInjector), CredentialsModule._UL__ULSEP_javax_inject_Provider_ULLT_com_oculus_auth_credentials_Credentials_ULGT__ULSEP_ACCESS_METHOD(applicationInjector), new C0088Gy(56, applicationInjector), new C00198b(135, applicationInjector));
                    } finally {
                        A00.A01();
                    }
                }
            }
        }
        return _UL__ULSEP_com_oculus_mobileconfig_init_MobileConfigInit_ULSEP_INSTANCE;
    }

    @Inject
    public MobileConfigInit(AbstractC0247Xu xu, @ForAppContext AbstractC0246Xt<Context> xt, AbstractC0246Xt<XAnalyticsProvider> xt2, AbstractC0246Xt<PackageInfo> xt3, eJ<AbstractC0234Xa> eJVar, eJ<Credentials> eJVar2, eJ<Locale> eJVar3, AbstractC0246Xt<IErrorReporter> xt4) {
        QC qc = new QC(1, xu);
        this._UL_mInjectionContext = qc;
        TAG = AnonymousClass06.A04(((MobileConfigInitOptions) AbstractC0096Hu.A03(0, 131, qc)).mTagPrefix, "MobileConfigInit");
        this.mContextLazy = xt;
        this.mXAnalyticsProvider = xt2;
        this.mPackageInfoProvider = xt3;
        this.mMobileConfigFactoryProvider = eJVar;
        this.mCredentialsProvider = eJVar2;
        this.mLocaleProvider = eJVar3;
        this.mErrorReporterLazy = xt4;
    }
}
