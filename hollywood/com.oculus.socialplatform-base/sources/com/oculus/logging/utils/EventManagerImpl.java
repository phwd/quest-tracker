package com.oculus.logging.utils;

import X.AbstractC03180ld;
import X.AnonymousClass0Hr;
import X.AnonymousClass0MD;
import X.AnonymousClass0RE;
import X.AnonymousClass0VC;
import X.AnonymousClass0VF;
import X.AnonymousClass0lg;
import X.AnonymousClass1TK;
import android.annotation.TargetApi;
import android.content.Context;
import android.os.PersistableBundle;
import com.facebook.ultralight.AutoGeneratedAccessMethod;
import com.facebook.ultralight.AutoGeneratedFactoryMethod;
import com.facebook.ultralight.Dependencies;
import com.facebook.ultralight.Inject;
import com.oculus.os.AnalyticsEvent;
import com.oculus.os.UnifiedTelemetryLogger;
import java.util.Iterator;
import javax.annotation.Nullable;
import javax.inject.Provider;
import org.json.JSONException;
import org.json.JSONObject;

@Dependencies({"_UL__ULSEP_com_oculus_logging_utils_StorageLoggingUtils_ULSEP_BINDING_ID", "_UL__ULSEP_android_content_Context_ULSEP_com_facebook_inject_ForAppContext_ULSEP_BINDING_ID"})
public class EventManagerImpl implements EventManager {
    public static final String TAG = "EventManagerImpl";
    public AnonymousClass0RE _UL_mInjectionContext;
    public final UnifiedTelemetryLogger mUnifiedTelemetryLogger;

    public class EventImpl implements Event {
        public final AnalyticsEvent mAnalyticsEvent;
        public final boolean mLowLatency;

        private void parseJson(String str) {
            String str2;
            try {
                JSONObject jSONObject = new JSONObject(str);
                Iterator<String> keys = jSONObject.keys();
                while (keys.hasNext()) {
                    String next = keys.next();
                    Object obj = jSONObject.get(next);
                    if (obj == null) {
                        str2 = null;
                    } else if (obj instanceof String) {
                        str2 = (String) obj;
                    } else if (obj instanceof Integer) {
                        addExtra(next, ((Number) obj).intValue());
                    } else if (obj instanceof Long) {
                        addExtra(next, ((Number) obj).longValue());
                    } else if (obj instanceof Double) {
                        addExtra(next, ((Number) obj).doubleValue());
                    } else if (obj instanceof Boolean) {
                        addExtra(next, ((Boolean) obj).booleanValue());
                    }
                    addExtra(next, str2);
                }
            } catch (JSONException e) {
                AnonymousClass0MD.A07(EventManagerImpl.TAG, "Failed to parse json string content", e);
            }
        }

        @Override // com.oculus.logging.utils.Event
        public Event appendStorageInformation() {
            Long internalFreeSpace = ((StorageLoggingUtils) AnonymousClass0VF.A03(0, 60, EventManagerImpl.this._UL_mInjectionContext)).getInternalFreeSpace();
            if (internalFreeSpace != null) {
                this.mAnalyticsEvent.setExtra(StorageLoggingUtils.FREE_SPACE_INTERNAL, internalFreeSpace);
            }
            Long sDFreeSpace = ((StorageLoggingUtils) AnonymousClass0VF.A03(0, 60, EventManagerImpl.this._UL_mInjectionContext)).getSDFreeSpace();
            if (sDFreeSpace != null) {
                this.mAnalyticsEvent.setExtra(StorageLoggingUtils.FREE_SPACE_SD, sDFreeSpace);
            }
            return this;
        }

        @Override // com.oculus.logging.utils.Event
        public void logAndRelease() {
            EventManagerImpl.this.mUnifiedTelemetryLogger.reportEvent(this.mAnalyticsEvent, this.mLowLatency);
        }

        @Override // com.oculus.logging.utils.Event
        public void setEventInDownloadedSamplingTag() {
            this.mAnalyticsEvent.setIsEventInSamplingConfigTag();
        }

        @Override // com.oculus.logging.utils.Event
        public void setEventInSessionlessSamplingConfigTag() {
            this.mAnalyticsEvent.setIsEventInSamplingConfigTag();
        }

        @Override // com.oculus.logging.utils.Event
        public void setHasDownloadedSamplingConfigTag() {
            this.mAnalyticsEvent.setHasDownloadedSamplingConfigTag();
        }

        @Override // com.oculus.logging.utils.Event
        public void setNtTagForInternalUse() {
            this.mAnalyticsEvent.setNtTag();
        }

        @Override // com.oculus.logging.utils.Event
        public void setReactNativeTagForInternalUse() {
            this.mAnalyticsEvent.setReactNativeTag();
        }

        @Override // com.oculus.logging.utils.Event
        public void setTime(long j) {
            this.mAnalyticsEvent.setTime(j);
        }

        @Override // com.oculus.logging.utils.Event
        public void setUslTagForInternalUse() {
            this.mAnalyticsEvent.setUslTag();
        }

        @Override // com.oculus.logging.utils.Event
        public void setXplatTagForInternalUse() {
            this.mAnalyticsEvent.setXplatTag();
        }

        public EventImpl(EventManagerImpl eventManagerImpl, String str) {
            this(eventManagerImpl, (String) null, str);
        }

        public EventImpl(@Nullable EventManagerImpl eventManagerImpl, String str, String str2) {
            this(str, str2, (String) null, false);
        }

        public EventImpl(@Nullable String str, String str2, @Nullable String str3, boolean z) {
            AnalyticsEvent analyticsEvent;
            this.mLowLatency = z;
            if (str != null) {
                analyticsEvent = new AnalyticsEvent(str, str2);
            } else {
                analyticsEvent = new AnalyticsEvent(str2);
            }
            this.mAnalyticsEvent = analyticsEvent;
            if (str3 != null) {
                parseJson(str3);
            }
        }

        public EventImpl(EventManagerImpl eventManagerImpl, @Nullable String str, String str2, boolean z) {
            this((String) null, str, str2, z);
        }

        @Override // com.oculus.logging.utils.Event
        public Event addExtra(String str, double d) {
            this.mAnalyticsEvent.setExtra(str, Double.valueOf(d));
            return this;
        }

        @Override // com.oculus.logging.utils.Event
        public Event addExtra(String str, int i) {
            this.mAnalyticsEvent.setExtra(str, Integer.valueOf(i));
            return this;
        }

        @Override // com.oculus.logging.utils.Event
        public Event addExtra(String str, long j) {
            this.mAnalyticsEvent.setExtra(str, Long.valueOf(j));
            return this;
        }

        @Override // com.oculus.logging.utils.Event
        public Event addExtra(String str, String str2) {
            this.mAnalyticsEvent.setExtra(str, str2);
            return this;
        }

        @Override // com.oculus.logging.utils.Event
        public Event addExtra(String str, boolean z) {
            this.mAnalyticsEvent.setExtra(str, Boolean.valueOf(z));
            return this;
        }
    }

    @AutoGeneratedAccessMethod
    public static final AbstractC03180ld _UL__ULSEP_com_facebook_inject_Lazy_ULLT_com_oculus_logging_utils_EventManagerImpl_ULGT__ULSEP_ACCESS_METHOD(AnonymousClass0lg r1) {
        return AnonymousClass0Hr.A00(44, r1);
    }

    @AutoGeneratedAccessMethod
    public static final EventManagerImpl _UL__ULSEP_com_oculus_logging_utils_EventManagerImpl_ULSEP_ACCESS_METHOD(AnonymousClass0lg r2) {
        return (EventManagerImpl) AnonymousClass1TK.A00(44, r2, null);
    }

    @AutoGeneratedFactoryMethod
    public static final EventManagerImpl _UL__ULSEP_com_oculus_logging_utils_EventManagerImpl_ULSEP_FACTORY_METHOD(AnonymousClass0lg r1, Object obj) {
        return new EventManagerImpl(r1);
    }

    @AutoGeneratedAccessMethod
    public static final Provider _UL__ULSEP_javax_inject_Provider_ULLT_com_oculus_logging_utils_EventManagerImpl_ULGT__ULSEP_ACCESS_METHOD(AnonymousClass0lg r1) {
        return AnonymousClass0VC.A00(44, r1);
    }

    @Override // com.oculus.logging.utils.EventManager
    public FunnelData createFunnelData() {
        return new FunnelDataImpl();
    }

    @Override // com.oculus.logging.utils.EventManager
    public void registerFunnel(String str, int i) {
        this.mUnifiedTelemetryLogger.registerFunnel(str, i);
    }

    @Inject
    public EventManagerImpl(AnonymousClass0lg r5) {
        this._UL_mInjectionContext = new AnonymousClass0RE(2, r5);
        UnifiedTelemetryLogger instance = UnifiedTelemetryLogger.getInstance();
        this.mUnifiedTelemetryLogger = instance;
        instance.init((Context) AnonymousClass0VF.A03(1, 3, this._UL_mInjectionContext));
    }

    public static /* synthetic */ String access$300() {
        return TAG;
    }

    @Override // com.oculus.logging.utils.EventManager
    public Event createEvent(String str) {
        return new EventImpl(this, str);
    }

    @Override // com.oculus.logging.utils.EventManager
    public Event createEvent(String str, String str2) {
        return new EventImpl(this, str, str2);
    }

    @Override // com.oculus.logging.utils.EventManager
    public Event createEvent(String str, @Nullable String str2, boolean z) {
        return new EventImpl(this, str, str2, z);
    }

    @Override // com.oculus.logging.utils.EventManager
    public void endFunnel(String str) {
        endFunnel(str, null);
    }

    @Override // com.oculus.logging.utils.EventManager
    public void endFunnel(String str, @Nullable Long l) {
        if (l != null) {
            this.mUnifiedTelemetryLogger.endFunnel(str, l.longValue());
        } else {
            this.mUnifiedTelemetryLogger.endFunnel(str);
        }
    }

    @Override // com.oculus.logging.utils.EventManager
    public void reportFunnelAction(String str, String str2, @Nullable Long l, @Nullable String str3, @Nullable FunnelData funnelData) {
        PersistableBundle persistableBundle = null;
        if (l != null) {
            UnifiedTelemetryLogger unifiedTelemetryLogger = this.mUnifiedTelemetryLogger;
            long longValue = l.longValue();
            if (funnelData != null) {
                persistableBundle = ((FunnelDataImpl) funnelData).mPersistableBundle;
            }
            unifiedTelemetryLogger.reportFunnelAction(str, longValue, str2, str3, persistableBundle);
            return;
        }
        UnifiedTelemetryLogger unifiedTelemetryLogger2 = this.mUnifiedTelemetryLogger;
        if (funnelData != null) {
            persistableBundle = ((FunnelDataImpl) funnelData).mPersistableBundle;
        }
        unifiedTelemetryLogger2.reportFunnelAction(str, str2, str3, persistableBundle);
    }

    @Override // com.oculus.logging.utils.EventManager
    public void reportFunnelAction(String str, String str2, @Nullable String str3, @Nullable FunnelData funnelData) {
        reportFunnelAction(str, str2, null, str3, funnelData);
    }

    @Override // com.oculus.logging.utils.EventManager
    public void startFunnel(String str) {
        startFunnel(str, null);
    }

    @Override // com.oculus.logging.utils.EventManager
    public void startFunnel(String str, @Nullable Long l) {
        if (l != null) {
            this.mUnifiedTelemetryLogger.startFunnel(str, l.longValue());
        } else {
            this.mUnifiedTelemetryLogger.startFunnel(str);
        }
    }

    @TargetApi(21)
    public class FunnelDataImpl implements FunnelData {
        public final PersistableBundle mPersistableBundle;

        public FunnelDataImpl() {
            this.mPersistableBundle = new PersistableBundle();
        }

        @Override // com.oculus.logging.utils.FunnelData
        public FunnelData addExtra(String str, int i) {
            this.mPersistableBundle.putInt(str, i);
            return this;
        }

        @Override // com.oculus.logging.utils.FunnelData
        public FunnelData addExtra(String str, long j) {
            this.mPersistableBundle.putLong(str, j);
            return this;
        }

        @Override // com.oculus.logging.utils.FunnelData
        public FunnelData addExtra(String str, String str2) {
            this.mPersistableBundle.putString(str, str2);
            return this;
        }
    }
}
