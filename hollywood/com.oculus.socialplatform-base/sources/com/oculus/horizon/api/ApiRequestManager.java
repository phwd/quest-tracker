package com.oculus.horizon.api;

import X.AbstractC03180ld;
import X.AnonymousClass0Hr;
import X.AnonymousClass0VC;
import X.AnonymousClass0lg;
import X.AnonymousClass1TK;
import androidx.annotation.VisibleForTesting;
import com.facebook.ultralight.AutoGeneratedAccessMethod;
import com.facebook.ultralight.AutoGeneratedFactoryMethod;
import com.facebook.ultralight.Dependencies;
import com.google.common.base.Preconditions;
import com.oculus.http.core.base.ApiCallback;
import com.oculus.http.core.base.ApiRequest;
import com.oculus.util.thread.ThreadUtils;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import javax.inject.Inject;
import javax.inject.Provider;

@Dependencies({"_UL__ULSEP_com_oculus_horizon_api_ApiDispatcher_ULSEP_BINDING_ID"})
public class ApiRequestManager {
    public final ApiDispatcher mApiDispatcher;
    public boolean mIsPaused;
    @VisibleForTesting
    public final List<ApiRequest> mRequests = new ArrayList();

    public void post(ApiRequest apiRequest, ApiCallback apiCallback) {
        postInternal(apiRequest, apiCallback, false);
    }

    public void postUnique(ApiRequest apiRequest, ApiCallback apiCallback) {
        postInternal(apiRequest, apiCallback, true);
    }

    @AutoGeneratedAccessMethod
    public static final AbstractC03180ld _UL__ULSEP_com_facebook_inject_Lazy_ULLT_com_oculus_horizon_api_ApiRequestManager_ULGT__ULSEP_ACCESS_METHOD(AnonymousClass0lg r1) {
        return AnonymousClass0Hr.A00(2091, r1);
    }

    @AutoGeneratedAccessMethod
    public static final ApiRequestManager _UL__ULSEP_com_oculus_horizon_api_ApiRequestManager_ULSEP_ACCESS_METHOD(AnonymousClass0lg r2) {
        return (ApiRequestManager) AnonymousClass1TK.A00(2091, r2, null);
    }

    @AutoGeneratedAccessMethod
    public static final Provider _UL__ULSEP_javax_inject_Provider_ULLT_com_oculus_horizon_api_ApiRequestManager_ULGT__ULSEP_ACCESS_METHOD(AnonymousClass0lg r1) {
        return AnonymousClass0VC.A00(2091, r1);
    }

    private <T> void postInternal(ApiRequest<T> apiRequest, ApiCallback<T> apiCallback, boolean z) {
        apiRequest.mCallback = apiCallback;
        synchronized (this.mRequests) {
            removeCompletedRequests();
            if (z) {
                for (ApiRequest apiRequest2 : this.mRequests) {
                    if (apiRequest2.getClass().equals(apiRequest.getClass())) {
                        return;
                    }
                }
            }
            if (this.mIsPaused) {
                apiCallback.mIsPaused = true;
            }
            this.mRequests.add(apiRequest);
            this.mApiDispatcher.post(apiRequest);
        }
    }

    private void removeCompletedRequests() {
        Iterator<ApiRequest> it = this.mRequests.iterator();
        while (it.hasNext()) {
            if (it.next().getCallback().mIsComplete) {
                it.remove();
            }
        }
    }

    public void destroy() {
        synchronized (this.mRequests) {
            Iterator<ApiRequest> it = this.mRequests.iterator();
            while (it.hasNext()) {
                it.next().getCallback().mIsPaused = true;
                it.remove();
            }
        }
    }

    @Inject
    public ApiRequestManager(ApiDispatcher apiDispatcher) {
        this.mApiDispatcher = apiDispatcher;
    }

    @AutoGeneratedFactoryMethod
    public static final ApiRequestManager _UL__ULSEP_com_oculus_horizon_api_ApiRequestManager_ULSEP_FACTORY_METHOD(AnonymousClass0lg r0, Object obj) {
        return new ApiRequestManager(ApiDispatcher._UL__ULSEP_com_oculus_horizon_api_ApiDispatcher_ULSEP_ACCESS_METHOD(r0));
    }

    public void pause() {
        ThreadUtils.assertOnUiThread();
        Preconditions.checkArgument(!this.mIsPaused);
        this.mIsPaused = true;
        synchronized (this.mRequests) {
            removeCompletedRequests();
            for (ApiRequest apiRequest : this.mRequests) {
                apiRequest.getCallback().mIsPaused = true;
            }
        }
    }

    public void resume() {
        ThreadUtils.assertOnUiThread();
        if (this.mIsPaused) {
            this.mIsPaused = false;
            LinkedList linkedList = new LinkedList();
            synchronized (this.mRequests) {
                linkedList.addAll(this.mRequests);
                Iterator it = linkedList.iterator();
                while (it.hasNext()) {
                    ((ApiRequest) it.next()).getCallback().resume();
                }
                removeCompletedRequests();
            }
        }
    }
}
